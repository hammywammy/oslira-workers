name = "oslira-workers"
main = "src/index.ts"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]

# ===========================
# KV NAMESPACE
# ===========================
[[kv_namespaces]]
binding = "OSLIRA_KV"
id = "dd86f413c4374811ac253bb9a6567182"  # ‚Üê Need to get this

# ===========================
# R2 BUCKET
# ===========================
[[r2_buckets]]
binding = "R2_CACHE_BUCKET"
bucket_name = "oslira-cache"

# ===========================
# ANALYTICS ENGINE
# ===========================
[[analytics_engine_datasets]]
binding = "ANALYTICS_ENGINE"

# ===========================
# CRON TRIGGERS
# ===========================
[triggers]
crons = [
  "0 3 1 * *",   # Monthly renewal (1st of month, 3 AM UTC)
  "0 2 * * *",   # Daily cleanup (2 AM UTC)
  "0 * * * *"    # Hourly failed analysis cleanup
]

# ===========================
# STAGING ENVIRONMENT
# ===========================
[env.staging]
name = "oslira-workers-staging"

[[env.staging.kv_namespaces]]
binding = "OSLIRA_KV"
id = "dd86f413c4374811ac253bb9a6567182"  

[[env.staging.r2_buckets]]
binding = "R2_CACHE_BUCKET"
bucket_name = "oslira-cache"  

[[env.staging.analytics_engine_datasets]]
binding = "ANALYTICS_ENGINE"

[env.staging.triggers]
crons = [
  "0 4 1 * *",
  "0 3 * * *",
  "0 * * * *"
]

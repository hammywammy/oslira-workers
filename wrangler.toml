name = "oslira-workers"
main = "src/index.ts"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]

[vars]
APP_ENV = "production"
AWS_REGION = "us-east-1"

# Analytics Engine (auto-available)
[[analytics_engine_datasets]]
binding = "ANALYTICS_ENGINE"

# Cron triggers
[triggers]
crons = [
  "0 3 1 * *",   # Monthly renewal (1st of month, 3 AM UTC)
  "0 2 * * *",   # Daily cleanup (2 AM UTC)
  "0 * * * *"    # Hourly failed analysis cleanup
]

# ===========================
# STAGING ENVIRONMENT
# ===========================
[env.staging]
name = "oslira-workers-staging"

[env.staging.vars]
APP_ENV = "staging"
AWS_REGION = "us-east-1"

[[env.staging.analytics_engine_datasets]]
binding = "ANALYTICS_ENGINE"

[env.staging.triggers]
crons = [
  "0 4 1 * *",   # Staging: 4 AM UTC
  "0 3 * * *",   # Staging: 3 AM UTC
  "0 * * * *"    # Hourly
]
